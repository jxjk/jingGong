# 生产环境部署说明

## 系统要求

- CentOS 7 服务器
- Docker (推荐版本 1.13.1+)
- Docker Compose (推荐版本 1.18.0+)

## 部署步骤

### 1. 安装 Docker 和 Docker Compose

```bash
# 您的系统已安装Docker 1.13.1版本和Docker Compose 1.18.0版本，可以跳过此步骤
```

### 2. 克隆项目代码

```bash
git clone https://github.com/jxjk/jingGong.git 
cd jingGong
```

### 3. 构建和启动服务

由于您的Docker Compose版本较旧，我们提供了兼容的配置文件：

```bash
# 构建镜像
docker-compose build

# 启动服务
docker-compose up -d
```

### 4. 访问应用

应用将在8000端口提供服务，可通过服务器IP和端口直接访问（例如：http://139.196.176.20:8000）。

## 环境变量配置

可以通过修改 docker-compose.yml 文件中的 environment 部分来配置环境变量：

- `DEBUG`: 设置为 0 以禁用调试模式

## 管理命令

```bash
# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f web

# 停止服务
docker-compose down

# 重启服务
docker-compose restart
```

## 数据备份和恢复

### 备份数据库

```bash
docker exec -t jinggong_db_1 pg_dump -U postgres machining_platform > backup.sql
```

### 恢复数据库

```bash
docker exec -T jinggong_db_1 psql -U postgres machining_platform < backup.sql
```

## 常见问题

### 1. Docker Compose 版本兼容性

您的系统使用的是 Docker Compose 1.18.0 版本，这是一个较旧的版本。我们已经调整了配置文件格式以确保兼容性。

### 2. 服务架构简化

由于Docker Compose版本限制，当前配置仅包含Web应用和数据库服务，没有包含Nginx反向代理。应用将直接通过8000端口访问。

### 3. 端口冲突

如果 8000 端口已被占用，可以修改 docker-compose.yml 中 web 服务的端口映射。

### 4. 权限问题

确保运行 docker 命令的用户具有相应权限，或将用户添加到 docker 组：

```bash
sudo usermod -aG docker $USER
```