# 生产环境部署说明

## 系统要求

- CentOS 7 服务器
- Docker (推荐版本 1.13.1+)
- Docker Compose (推荐版本 1.18.0+)

## 部署步骤

### 1. 安装 Docker 和 Docker Compose

```bash
# 如果系统中没有安装Docker，可以使用以下命令安装
# 注意：您的系统已安装Docker 1.13.1版本，可以跳过此步骤

# 安装EPEL仓库
sudo yum install -y epel-release

# 安装Docker
sudo yum install -y docker

# 启动 Docker 服务
sudo systemctl start docker
sudo systemctl enable docker

# 安装 Docker Compose (如果版本过低)
# 注意：您的系统已安装Docker Compose 1.18.0版本，可以跳过此步骤
```

### 2. 克隆项目代码

```bash
git clone https://github.com/jxjk/jingGong.git 
cd jingGong
```

### 3. 构建和启动服务

```bash
# 构建镜像
docker-compose build

# 启动服务
docker-compose up -d
```

### 4. 访问应用

应用将通过 Nginx 代理在 80 端口提供服务，可通过服务器 IP 直接访问。

## 环境变量配置

可以通过修改 docker-compose.yml 文件中的 environment 部分来配置环境变量：

- `DEBUG`: 设置为 0 以禁用调试模式
- `DB_HOST`: 数据库主机地址
- `DB_NAME`: 数据库名称
- `DB_USER`: 数据库用户名
- `DB_PASSWORD`: 数据库密码
- `CREATE_SUPERUSER`: 是否创建超级用户
- `DJANGO_SUPERUSER_USERNAME`: 超级用户名
- `DJANGO_SUPERUSER_EMAIL`: 超级用户邮箱
- `DJANGO_SUPERUSER_PASSWORD`: 超级用户密码

## 管理命令

```bash
# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f web

# 停止服务
docker-compose down

# 重启服务
docker-compose restart
```

## 数据备份和恢复

### 备份数据库

```bash
docker-compose exec db pg_dump -U postgres machining_platform > backup.sql
```

### 恢复数据库

```bash
docker-compose exec -T db psql -U postgres machining_platform < backup.sql
```

## 常见问题

### 1. Docker Compose 版本兼容性

您的系统使用的是 Docker Compose 1.18.0 版本，这已经足够运行本项目。配置文件已针对此版本进行了优化。

### 2. Docker 版本兼容性

您的系统使用的是 Docker 1.13.1 版本，这已经足够运行本项目。配置文件已针对此版本进行了优化。

### 3. 端口冲突

如果 80 端口已被占用，可以修改 docker-compose.yml 中 nginx 的端口映射。

### 4. 权限问题

确保运行 docker 命令的用户具有相应权限，或将用户添加到 docker 组：

```bash
sudo usermod -aG docker $USER
```