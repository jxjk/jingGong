{% extends 'base.html' %}

{% block title %}报价详情 - 精工智造{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">报价详情 #{{ quote.id }}</h1>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>客户信息</h5>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <tr>
                        <td><strong>姓名</strong></td>
                        <td>{{ quote.name }}</td>
                    </tr>
                    <tr>
                        <td><strong>邮箱</strong></td>
                        <td>{{ quote.email }}</td>
                    </tr>
                    <tr>
                        <td><strong>电话</strong></td>
                        <td>{{ quote.phone }}</td>
                    </tr>
                    <tr>
                        <td><strong>提交时间</strong></td>
                        <td>{{ quote.created_at|date:"Y-m-d H:i" }}</td>
                    </tr>
                    <tr>
                        <td><strong>处理状态</strong></td>
                        <td>
                            {% if quote.is_processed %}
                                <span class="badge bg-success">已处理</span>
                            {% else %}
                                <span class="badge bg-warning">待处理</span>
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>项目信息</h5>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <tr>
                        <td><strong>加工类型</strong></td>
                        <td>{{ quote.get_processing_type_display }}</td>
                    </tr>
                    <tr>
                        <td><strong>材料</strong></td>
                        <td>{{ quote.get_material_display }}</td>
                    </tr>
                    <tr>
                        <td><strong>数量</strong></td>
                        <td>{{ quote.quantity }}</td>
                    </tr>
                    <tr>
                        <td><strong>精度要求</strong></td>
                        <td>{{ quote.accuracy }}</td>
                    </tr>
                    <tr>
                        <td><strong>表面处理</strong></td>
                        <td>{{ quote.get_surface_treatment_display }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>附加信息</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6>附加说明</h6>
                    {% if quote.description %}
                        <p>{{ quote.description|linebreaks }}</p>
                    {% else %}
                        <p class="text-muted">无附加说明</p>
                    {% endif %}
                </div>
                
                {% if quote.model_file %}
                <div class="mb-3">
                    <h6>3D模型文件</h6>
                    <p><a href="{{ quote.model_file.url }}" target="_blank">{{ quote.model_file.name }}</a></p>
                </div>
                {% endif %}
                
                {% if quote.volume or quote.surface_area %}
                <div class="mb-3">
                    <h6>模型分析结果</h6>
                    <table class="table table-bordered">
                        {% if quote.volume %}
                        <tr>
                            <td><strong>体积</strong></td>
                            <td>{{ quote.volume|floatformat:2 }} cm³</td>
                        </tr>
                        {% endif %}
                        
                        {% if quote.surface_area %}
                        <tr>
                            <td><strong>表面积</strong></td>
                            <td>{{ quote.surface_area|floatformat:2 }} cm²</td>
                        </tr>
                        {% endif %}
                        
                        {% if quote.bounding_box_length %}
                        <tr>
                            <td><strong>尺寸</strong></td>
                            <td>{{ quote.bounding_box_length|floatformat:2 }} × {{ quote.bounding_box_width|floatformat:2 }} × {{ quote.bounding_box_height|floatformat:2 }} mm</td>
                        </tr>
                        {% endif %}
                        
                        {% if quote.complexity_score %}
                        <tr>
                            <td><strong>复杂度评分</strong></td>
                            <td>{{ quote.complexity_score|floatformat:1 }}/5</td>
                        </tr>
                        {% endif %}
                        
                        {% if quote.max_aspect_ratio %}
                        <tr>
                            <td><strong>最大径长比</strong></td>
                            <td>{{ quote.max_aspect_ratio|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                        
                        <!-- 注释掉最小拐角半径的显示 -->
                        <!--
                        {% if quote.min_radius %}
                        <tr>
                            <td><strong>最小拐角半径</strong></td>
                            <td>{{ quote.min_radius|floatformat:2 }} mm</td>
                        </tr>
                        {% endif %}
                        -->
                        
                        <!-- 注释掉最小刀具直径的显示 -->
                        <!--
                        {% if quote.min_tool_diameter %}
                        <tr>
                            <td><strong>最小刀具直径</strong></td>
                            <td>{{ quote.min_tool_diameter|floatformat:2 }} mm</td>
                        </tr>
                        {% endif %}
                        -->
                        
                        {% if quote.machining_difficulty %}
                        <tr>
                            <td><strong>加工难度评分</strong></td>
                            <td>{{ quote.machining_difficulty|floatformat:1 }}/5</td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <a href="{% url 'quotation:admin_quote_list' %}" class="btn btn-secondary">返回列表</a>
        {% if not quote.is_processed %}
        <button type="button" class="btn btn-success" onclick="markAsProcessed({{ quote.id }})">标记为已处理</button>
        {% endif %}
    </div>
</div>

<script>
function markAsProcessed(quoteId) {
    if (confirm('确定要将此报价标记为已处理吗？')) {
        // 这里可以添加AJAX请求来更新处理状态
        alert('在完整实现中，这将通过AJAX更新处理状态');
        location.reload();
    }
}
</script>
{% endblock %}